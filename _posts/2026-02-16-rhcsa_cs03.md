---
title: RHCSA CS03 - httpd 서비스, SELinux, 방화벽
author: Me
date: 2026-02-16
categories:
  - 취업준비
  - 리눅스
published: true
---

## 덤프 문제

```
비표준 포트 82에서 실행 중인 웹 서버가 서비스 제공 시 문제를 겪고 있다. 다음 조건을 충족하도록 트러블슈팅을 하라 :


시스템의 웹 서버가 /var/www/html에 있는 모든 기존 HTML 파일을 제공할 수 있어야 한다. (참고: 기존 파일의 내용을 삭제하거나 수정하지 말것)

웹 서버가 포트 82로 서비스가 되도록 하라

웹 서버가 시스템이 시작될 때 자동으로 시작되어야 한다.
```

## 환경 설정

연습하기 위해 시험을 위한 환경을 가상으로 갖춰둔다.

```
# 1. httpd 설치
dnf install -y httpd

# 2. 설정이 잘못된 테스트용 파일 생성
echo "RHCSA Test Page" > /var/www/html/index.html
chcon -t user_home_t /var/www/html/index.html # 웹서버가 권한 오류로 403 Forbidden
```

### 확인
NAT 설정으로 돼있기 때문에 들어갈 수 있을 줄 알았는데(403 에러가 뜨더라도)
![image](assets/img/2026-02-16-rhcsa_cs03/IMG-20260216195014405.png)

안 들어가진다... 아마 방화벽 때문인듯.

일단 풀이를 해보자.

## 풀이법

```
# 1. port 80 -> 82로 변경
vi /etc/httpd/conf/httpd.conf
# Listen 80 부분을 82로 변경
```

![image](assets/img/2026-02-16-rhcsa_cs03/IMG-20260216195141828.png)

```
# 2. httpd 데몬 자동 재시작 설정
systemctl enable --now httpd
# --now: 재시작하지 않아도 바로 반영됨. 시간 절약용.
```

![image](assets/img/2026-02-16-rhcsa_cs03/IMG-20260216195307404.png)
위와 같은 오류가 뜰 텐데 뜨는 게 정상이라 함.
SELinux가 82번 포트를 막고 있기 때문.
오류로그를 확인하는 명령어를 친절히 알려주고 있다. 한 번 쳐보자.



```
# 오류 로그 확인
journalctl -xeu httpd.service
```

![image](assets/img/2026-02-16-rhcsa_cs03/IMG-20260216195446157.png)

localhost의 82번 포트에 바인드를 못 하고 있다.

이러면 바로 '아, 내부 보안 시스템에서 이 포트를 웹서버에게 안 열어줬구나!' 알아채야 한다.

그러니까 `semanage port` 명령어를 떠올려야 한다!


```
# 3. 포트 허용
semanage port -a -t http_port_t -p tcp 82

# 4. 파일 권한 복구
restorecon -v /var/www/html/index.html

# 5. 서비스 재시작
systemctl restart httpd
```

- semanage: SELinux 정책을 조회, 수정하는 도구
	- semanage port : 네트워크 포트 관련 설정 
	- -a : add / -m(modify) / -d(delete) / -l(list)
	- -t http_port_t : SELinux type을 http_port_t로 지정
	- -p tcp: protocol을 tcp로 지정
	- 여기서 http_port_t가 뭔가 하니 SELinux에서 미리 'http 용도로 쓸 거다' 라고 명시적으로 지정해놓은 객체 레이블이라고 한다. http_port_t라는 레이블에 기본적으로 할당된 포트는 80, 443, 8080 등이 있다. 이 안에 뭐가 있는지 보려면 `semanage port -l | grep "http"` 로 검색할 수 있다.
- restorecon: SELinux 레이블을 시스템 데이터베이스에 정의된대로 복구.
	- -Rv : Recursive + Verbose. 하위 디렉토리를 전부 포함하고, 화면에 보여달라는 명령어.



여기까지 해줘도 아직 접속이 안 된다. 마지막으로 방화벽 설정.

```
# 6. 방화벽 오픈
firewall-cmd --permanent --add-port=82/tcp
firewall-cmd --reload
```

이제 `http://(내 호스트 아이피):82` 로 접속이 되나 확인해보면
![image](assets/img/2026-02-16-rhcsa_cs03/IMG-20260216195828499.png)

된다 !!


## \<추가 정보>

### 시험장에서 설정 제대로 됐는지 검증하는 방법

```
# 1. 포트 리스닝 확인
ss -antlp | grep 82

# 2. SELinux 레이블 확인
ls -Z /var/www/html/index.html # 타입이 httpd_sys_content_t 여야 함.

# 3. 최종 접속 확인
curl http://localhost:82

```


### 시험장에 semanage가 안 깔려있다면?

```bash
dnf provides semanage # 패키지 이름 검색
dnf install -y {패키지이름}
```

### 시험장에서 명령어 옵션이 정확히 기억이 안 날 때 꿀팁
예시) semanage port 어쩌고였던 것 같긴 한데 정확히 옵션을 어떤 식으로 썼는지 기억이 안 날 때
```bash
man semanage-port

# man 페이지가 열리면
/EXAMPLE

# 사용 예시 위치로 바로 이동됨.
```
RHCSA 시험 문제는 보통 이 예제에서 옵션 값만 살짝 바꾼 경우가 많다고 한다.

만약 man으로 안 나오면
```bash
dnf install -y man-pages man-db
```
빠르게 패키지를 설치한다.
(시험장에서 패키지를 설치할 수 없을 수도 있으니 주의. 이 경우 그냥 명령어의 --help 옵션을 믿는 수밖에...)

### SELinux가 뭔가?

리눅스의 강력한 보안 시스템이라고 한다.

리눅스는 기본적으로 파일 권한(rwx)을 통해 보안을 유지하지만 그것으로 부족한 점을 SELinux로 보완하는 느낌.

가령, 해커가 웹서버의 취약점을 뚫고 들어와 root 권한을 얻었을 경우, 모든 것을 할 수 있게 된다.
`/etc/shadow`를 탈취하는 등...

리눅스가 임의적 접근 제어(DAC)를 채택하고 있기 때문이다.
(DAC: 신분을 기반으로 접근을 제어하는 것. 최고 관리자 root 권한을 획득하면 무소불위의 권력을 얻게 된다...)

SELinux는 강제적 접근 제어(MAC)로 동작한다.
(MAC: 보안 등급을 기반으로 접근을 제어하는 것.)
SELinux는 모든 프로세스와 파일/포트에 레이블을 붙인 뒤 각 레이블 간의 허용 권한을 설정해둠.
가령, 웹 서버 프로세스에는 httpd_t라는 레이블을 붙이고 웹 홈페이지 파일엔 httpd_sys_content_t 라는 레이블을 붙인 뒤, httpd_t 레이블은 httpd_sys_content_t를 읽을 수 있다는 정책을 시행하는 식.


### 서비스 관련 로그를 보는 방법

journalctl -xeu는 '시스템 서비스 로그'라고 한다. "서비스가 왜 안 켜지지?"를 확인할 때 쓴다고.

안내 메시지로 나오지 않을 수도 있으니 외워두자.

`/var/log/httpd/error_log` 파일을 확인하는 방법도 있다. 이쪽은 "서비스는 켜졌는데 특정 페이지만 안 나올 때" 쓴다.

`systemctl status httpd.service` 는 현재 서비스의 상태와 로그 몇 줄을 보여준다. 하지만 로그를 길게 보려면 journalctl이 나은듯...


### restorecon을 하는 이유

문제를 시뮬레이션 해보면, httpd 서비스를 재시작해보고, 오류 로그를 확인하고, port가 잠겨있다는 걸 보고 selinux를 떠올려서 semanage port를 실행하는 것까진 합리적이다.
근데 restorecon은 왜 하는지 이해가 안 돼서 제미나이에게 물어봤다.

```
지금 상황에서 **`systemctl restart httpd`가 성공했다면** 포트 문제는 해결된 것입니다!

하지만 그 후 `curl http://localhost:82`를 했을 때 웹 페이지 내용이 안 나오고 **"403 Forbidden"**이 뜬다면, 그때 비로소 **`restorecon`** 카드를 꺼내시면 됩니다. 시험 문제에 "파일을 제공할 수 있어야 한다"는 말이 명시되어 있다면, 출제자가 파일 이름표를 고의로 틀려놨을 확률이 99%거든요.
```

라고 한다.

문제에서 굳이 '모든 파일을 제공할 수 있어야 한다' 라고 했다면 이 레이블을 의도적으로 건드려놨을 확률이 높다고...

이 명령어도 외워두도록 하자.

### /var/ww/html/index.html 파일의 chmod도 체크할 것

추가로, '모든 파일을 제공할 수 있어야 한다'가 SELinux를 아는지 테스트하는 것일 수도 있지만 이쪽은 2차 보안이고 1차 보안 문제일 가능성도 있다고 한다.

`chmod` 말이다.

httpd는 apache라는 일반 사용자 권한으로 /var/www/html/index.html 파일에 접근한다.
만약 이 파일의 권한이 600(rw- --- ---)이고 소유자가 root라면, 오로지 root만 읽고 수정할 수 있는 파일이 된다.
이 경우 apache가 파일 읽기에 실패해 403 Forbidden이 뜬다.

이 경우 `chmod 644 /var/www/html/index.html`로 group과 other의 r 권한을 열어주도록 하자.

### 방화벽 설정도 잊지 않기

```bash
firewall-cmd --permanent --add-port=82/tcp
firewall-cmd --reload
```

로컬에서 잘 보여도 시험감독관의 pc에서 접속이 안 되면 오답이다.

잊지 말고 해주자 !

```bash
firewall-cmd --list-all
# 모든 방화벽 정책을 확인
```
