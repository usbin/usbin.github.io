---
title: RHCSA CS03 - httpd, selinux
author: Me
date: 2026-02-16
categories:
  - 취업준비
  - 리눅스
published: false
---

## 덤프 문제

```
비표준 포트 82에서 실행 중인 웹 서버가 서비스 제공 시 문제를 겪고 있다. 다음 조건을 충족하도록 트러블슈팅을 하라 :


시스템의 웹 서버가 /var/www/html에 있는 모든 기존 HTML 파일을 제공할 수 있어야 한다. (참고: 기존 파일의 내용을 삭제하거나 수정하지 말것)

웹 서버가 포트 82로 서비스가 되도록 하라

웹 서버가 시스템이 시작될 때 자동으로 시작되어야 한다.
```

## 환경 설정

연습하기 위해 시험을 위한 환경을 가상으로 갖춰둔다.

```
# 1. httpd 설치
dnf install -y httpd

# 2. 설정이 잘못된 테스트용 파일 생성
echo "RHCSA Test Page" > /var/www/html/index.html
chcon -t user_home_t /var/www/html/index.html # 웹서버가 권한 오류로 403 Forbidden
```

### 확인
NAT 설정으로 돼있기 때문에 들어갈 수 있을 줄 알았는데(403 에러가 뜨더라도)
![image](assets/img/2026-02-16-rhcsa_cs03/IMG-20260216195014405.png)

안 들어가진다... 아마 방화벽 때문인듯.

일단 풀이를 해보자.

## 풀이법

```
# 1. port 80 -> 82로 변경
vi /etc/httpd/conf/httpd.conf
# Listen 80 부분을 82로 변경
```

![image](assets/img/2026-02-16-rhcsa_cs03/IMG-20260216195141828.png)

```
# 2. httpd 데몬 자동 재시작 설정
systemctl enable --now httpd
```

![image](assets/img/2026-02-16-rhcsa_cs03/IMG-20260216195307404.png)
위와 같은 오류가 뜰 텐데 뜨는 게 정상이라 함.
SELinux가 82번 포트를 막고 있기 때문.

```
# 오류 로그 확인
journalctl -xeu httpd
```

![image](assets/img/2026-02-16-rhcsa_cs03/IMG-20260216195446157.png)

```
# 3. 포트 허용
semanage port -a -t http_port_t -p tcp 82

# 4. 파일 권한 복구
restorecon -v /var/www/html/index.html

# 5. 서비스 재시작
systemctl restart httpd
```

- semanage: SELinux 정책을 조회, 수정하는 도구
	- semanage port : 네트워크 포트 관련 설정 
	- -a : add / -m(modify) / -d(delete) / -l(list)
	- -t http_port_t : SELinux type을 http_port_t로 지정
	- -p tcp: protocol을 tcp로 지정
- 여기서 http_port_t가 뭔가 하니 SELinux에서 미리 'http 용도로 쓸 거다' 라고 명시적으로 지정해놓은 객체 레이블이라고 한다. http_port_t라는 레이블에 기본적으로 할당된 포트는 80, 443, 8080 등이 있다. 이 안에 뭐가 있는지 보려면 `semanage port -l | grep "http"` 로 검색할 수 있다.

아직 접속이 안 된다. 마지막으로 방화벽 설정.

```
# 6. 방화벽 오픈
firewall-cmd --permanent --add-port=82/tcp
firewall-cmd --reload
```

이제 `http://(내 호스트 아이피):82` 로 접속이 되나 확인해보면
![image](assets/img/2026-02-16-rhcsa_cs03/IMG-20260216195828499.png)

된다 !!


## \<추가 정보>

### 시험장에서 설정 제대로 됐는지 검증하는 방법

```
# 1. 포트 리스닝 확인
ss -antlp | grep 82

# 2. SELinux 레이블 확인
ls -Z /var/www/html/index.html # 타입이 httpd_sys_content_t 여야 함.

# 3. 최종 접속 확인
curl http://localhost:82

```


### 시험장에 semanage가 안 깔려있다면?

```
dnf provides semanage # 패키지 이름 검색
dnf install -y {패키지이름}
```

### 시험장에서 명령어 옵션이 정확히 기억이 안 날 때 꿀팁
예시) semanage port 어쩌고였던 것 같긴 한데 정확히 옵션을 어떤 식으로 썼는지 기억이 안 날 때
```
man semanage-port

# man 페이지가 열리면
/EXAMPLE

# 사용 예시 위치로 바로 이동됨.
```
RHCSA 시험 문제는 보통 이 예제에서 옵션 값만 살짝 바꾼 경우가 많다고 한다.



### SELinux가 뭔가?

리눅스의 강력한 보안 시스템이라고 한다.

리눅스는 기본적으로 파일 권한(rwx)을 통해 보안을 유지하지만 그것으로 부족한 점을 SELinux로 보완하는 느낌.

가령, 해커가 웹서버의 취약점을 뚫고 들어와 root 권한을 얻었을 경우, 모든 것을 할 수 있게 된다.
`/etc/shadow`를 탈취하는 등...

리눅스가 임의적 접근 제어(DAC)를 채택하고 있기 때문이다.
(DAC: 신분을 기반으로 접근을 제어하는 것. 최고 관리자 root 권한을 획득하면 무소불위의 권력을 얻게 된다...)

SELinux는 강제적 접근 제어(MAC)로 동작한다.
(MAC: 보안 등급을 기반으로 접근을 제어하는 것.)
SELinux는 모든 프로세스와 파일/포트에 레이블을 붙인 뒤 각 레이블 간의 허용 권한을 설정해둠.
가령, 웹 서버 프로세스에는 httpd_t라는 레이블을 붙이고 웹 홈페이지 파일엔 httpd_sys_content_t 라는 레이블을 붙인 뒤, httpd_t 레이블은 httpd_sys_content_t를 읽을 수 있다는 정책을 시행하는 식.

